"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var express = require("express");
var fs_1 = require("fs");
var path_1 = require("path");
var _1 = require("./common/");
var order_1 = require("./order");
var filePath = path_1.join(__dirname, './data/users.db.json');
var User = (function () {
    function User(data) {
        this.userId = _1.createGUID();
        // copies every property of data to this
        Object.assign(this, data);
    }
    User.getAllUsers = function () {
        return JSON.parse(fs_1.readFileSync(filePath).toString());
    };
    User.getUser = function (id) {
        return this.getAllUsers().find(function (u) { return u.userId === id; });
    };
    User.createUser = function (data) {
        var user = new User(data);
        var users = this.getAllUsers();
        users.push(user);
        this.saveAllUsers(users);
        return user;
    };
    User.updateUser = function (data) {
        var users = this.getAllUsers();
        var userIndex = users.findIndex(function (u) { return u.userId === data.id; });
        users.splice(userIndex, 1, data);
        this.saveAllUsers(users);
        return data;
    };
    User.deleteUser = function (id) {
        var users = this.getAllUsers();
        var userIndex = users.findIndex(function (u) { return u.userId === id; });
        users.splice(userIndex, 1);
        this.saveAllUsers(users);
    };
    User.saveAllUsers = function (userList) {
        fs_1.writeFileSync(filePath, JSON.stringify(userList, null, 2));
    };
    return User;
}());
exports.User = User;
exports.UserRouter = express.Router();
exports.UserRouter.get('/user-list', function (req, res) {
    res.json(User.getAllUsers());
});
exports.UserRouter.get('/:userId', function (req, res) {
    res.json(User.getUser(req.params.id));
});
// create user
exports.UserRouter.post('/', function (req, res) {
    res.json(User.createUser(req.body));
});
// update user
exports.UserRouter.post('/:userId', function (req, res) {
    var data = req.body;
    data.id = req.params.id;
    res.json(User.updateUser(data));
});
// delete user
exports.UserRouter.delete('/:userId', function (req, res) {
    var id = req.params.id;
    res.json(User.deleteUser(id));
});
exports.UserRouter.get('/:userId/orders', function (req, res) {
    res.json(order_1.Order.getBookOrders(req.params.id));
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL2hvbWUvaG9zcG9naC9EZXNrdG9wL2JldFByb2plY3RMaWJyYXJpdW0vbGlicmFyaXVtL3NyYy9zZXJ2ZXItYXBpL3VzZXIudHMiLCJzb3VyY2VzIjpbIi9ob21lL2hvc3BvZ2gvRGVza3RvcC9iZXRQcm9qZWN0TGlicmFyaXVtL2xpYnJhcml1bS9zcmMvc2VydmVyLWFwaS91c2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsaUNBQW1DO0FBQ25DLHlCQUErQztBQUMvQyw2QkFBMEI7QUFDMUIsOEJBQXFDO0FBQ3JDLGlDQUE4QjtBQUU5QixJQUFNLFFBQVEsR0FBRyxXQUFJLENBQUMsU0FBUyxFQUFFLHNCQUFzQixDQUFDLENBQUM7QUFFekQ7SUFVRSxjQUFZLElBQUk7UUFUaEIsV0FBTSxHQUFXLGFBQVUsRUFBRSxDQUFDO1FBVTVCLHdDQUF3QztRQUN4QyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztJQUM1QixDQUFDO0lBRU0sZ0JBQVcsR0FBbEI7UUFDRSxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxpQkFBWSxDQUFDLFFBQVEsQ0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUM7SUFDdkQsQ0FBQztJQUVNLFlBQU8sR0FBZCxVQUFlLEVBQVU7UUFDdkIsTUFBTSxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQyxJQUFJLENBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsTUFBTSxLQUFLLEVBQUUsRUFBZixDQUFlLENBQUMsQ0FBQztJQUN2RCxDQUFDO0lBRU0sZUFBVSxHQUFqQixVQUFrQixJQUFJO1FBQ3BCLElBQU0sSUFBSSxHQUFHLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzVCLElBQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNqQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2pCLElBQUksQ0FB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QUFDO0FBRUgsa0JBQVUsQ0FBQyxHQUFHLENBQUMsaUJBQWlCLEVBQUUsVUFBQyxHQUFHLEVBQUUsR0FBRztJQUN6QyxHQUFHLENBQUMsSUFBSSxDQUFDLGFBQUssQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0FBQy9DLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgZXhwcmVzcyBmcm9tICdleHByZXNzJztcbmltcG9ydCB7cmVhZEZpbGVTeW5jLCB3cml0ZUZpbGVTeW5jfSBmcm9tICdmcyc7XG5pbXBvcnQge2pvaW59IGZyb20gJ3BhdGgnO1xuaW1wb3J0IHtjcmVhdGVHVUlEfSBmcm9tICcuL2NvbW1vbi8nO1xuaW1wb3J0IHtPcmRlcn0gZnJvbSAnLi9vcmRlcic7XG5cbmNvbnN0IGZpbGVQYXRoID0gam9pbihfX2Rpcm5hbWUsICcuL2RhdGEvdXNlcnMuZGIuanNvbicpO1xuXG5leHBvcnQgY2xhc3MgVXNlciB7XG4gIHVzZXJJZDogc3RyaW5nID0gY3JlYXRlR1VJRCgpO1xuICBsb2dpbjogc3RyaW5nO1xuICBwYXNzd29yZDogc3RyaW5nO1xuICBmaXJzdE5hbWU6IHN0cmluZztcbiAgbGFzdE5hbWU6IHN0cmluZztcbiAgZ2VuZGVyOiBzdHJpbmc7XG4gIGVtYWlsOiBzdHJpbmc7XG4gIHBob25lTnVtYmVyPzogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKGRhdGEpIHtcbiAgICAvLyBjb3BpZXMgZXZlcnkgcHJvcGVydHkgb2YgZGF0YSB0byB0aGlzXG4gICAgT2JqZWN0LmFzc2lnbih0aGlzLCBkYXRhKTtcbiAgfVxuXG4gIHN0YXRpYyBnZXRBbGxVc2VycygpOiBVc2VyW10ge1xuICAgIHJldHVybiBKU09OLnBhcnNlKHJlYWRGaWxlU3luYyhmaWxlUGF0aCkudG9TdHJpbmcoKSk7XG4gIH1cblxuICBzdGF0aWMgZ2V0VXNlcihpZDogc3RyaW5nKTogVXNlciB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0QWxsVXNlcnMoKS5maW5kKHUgPT4gdS51c2VySWQgPT09IGlkKTtcbiAgfVxuXG4gIHN0YXRpYyBjcmVhdGVVc2VyKGRhdGEpIHtcbiAgICBjb25zdCB1c2VyID0gbmV3IFVzZXIoZGF0YSk7XG4gICAgY29uc3QgdXNlcnMgPSB0aGlzLmdldEFsbFVzZXJzKCk7XG4gICAgdXNlcnMucHVzaCh1c2VyKTtcbiAgICB0aGlzLnNhdmVBbGxVc2Vycyh1c2Vycyk7XG4gICAgcmV0dXJuIHVzZXI7XG4gIH1cblxuICBzdGF0aWMgdXBkYXRlVXNlcihkYXRhKSB7XG4gICAgY29uc3QgdXNlcnMgPSB0aGlzLmdldEFsbFVzZXJzKCk7XG4gICAgY29uc3QgdXNlckluZGV4ID0gdXNlcnMuZmluZEluZGV4KHUgPT4gdS51c2VySWQgPT09IGRhdGEuaWQpO1xuICAgIHVzZXJzLnNwbGljZSh1c2VySW5kZXgsIDEsIGRhdGEpO1xuICAgIHRoaXMuc2F2ZUFsbFVzZXJzKHVzZXJzKTtcbiAgICByZXR1cm4gZGF0YTtcbiAgfVxuXG4gIHN0YXRpYyBkZWxldGVVc2VyKGlkKSB7XG4gICAgY29uc3QgdXNlcnMgPSB0aGlzLmdldEFsbFVzZXJzKCk7XG4gICAgY29uc3QgdXNlckluZGV4ID0gdXNlcnMuZmluZEluZGV4KHUgPT4gdS51c2VySWQgPT09IGlkKTtcbiAgICB1c2Vycy5zcGxpY2UodXNlckluZGV4LCAxKTtcbiAgICB0aGlzLnNhdmVBbGxVc2Vycyh1c2Vycyk7XG4gIH1cblxuICBzdGF0aWMgc2F2ZUFsbFVzZXJzKHVzZXJMaXN0KSB7XG4gICAgd3JpdGVGaWxlU3luYyhmaWxlUGF0aCwgSlNPTi5zdHJpbmdpZnkodXNlckxpc3QsIG51bGwsIDIpKTtcbiAgfVxufVxuXG5leHBvcnQgY29uc3QgVXNlclJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XG5cblVzZXJSb3V0ZXIuZ2V0KCcvdXNlci1saXN0JywgKHJlcSwgcmVzKSA9PiB7XG4gIHJlcy5qc29uKFVzZXIuZ2V0QWxsVXNlcnMoKSk7XG59KTtcblxuVXNlclJvdXRlci5nZXQoJy86dXNlcklkJywgKHJlcSwgcmVzKSA9PiB7XG4gIHJlcy5qc29uKFVzZXIuZ2V0VXNlcihyZXEucGFyYW1zLmlkKSk7XG59KTtcblxuLy8gY3JlYXRlIHVzZXJcblVzZXJSb3V0ZXIucG9zdCgnLycsIChyZXEsIHJlcykgPT4ge1xuICByZXMuanNvbihVc2VyLmNyZWF0ZVVzZXIocmVxLmJvZHkpKTtcbn0pO1xuXG4vLyB1cGRhdGUgdXNlclxuVXNlclJvdXRlci5wb3N0KCcvOnVzZXJJZCcsIChyZXEsIHJlcykgPT4ge1xuICBjb25zdCBkYXRhID0gcmVxLmJvZHk7XG4gIGRhdGEuaWQgPSByZXEucGFyYW1zLmlkO1xuICByZXMuanNvbihVc2VyLnVwZGF0ZVVzZXIoZGF0YSkpO1xufSk7XG5cbi8vIGRlbGV0ZSB1c2VyXG5Vc2VyUm91dGVyLmRlbGV0ZSgnLzp1c2VySWQnLCAocmVxLCByZXMpID0+IHtcbiAgY29uc3QgaWQgPSByZXEucGFyYW1zLmlkO1xuICByZXMuanNvbihVc2VyLmRlbGV0ZVVzZXIoaWQpKTtcbn0pO1xuXG5Vc2VyUm91dGVyLmdldCgnLzp1c2VySWQvb3JkZXJzJywgKHJlcSwgcmVzKSA9PiB7XG4gIHJlcy5qc29uKE9yZGVyLmdldEJvb2tPcmRlcnMocmVxLnBhcmFtcy5pZCkpO1xufSk7XG4iXX0=